{% extends "op/base.html" %}

{% load i18n %}

{% block extrahead %}
<script type="text/javascript" src="http://proximitymarketing.googlecode.com/svn/trunk/openproximity2/latest-version.js"></script>
{% endblock %}

{% block content %}
<script type="text/javascript">
    var reply=compare_version({{version.current}});
    if ( reply.new_available ){
        document.write("<h1><a href=\"http://code.google.com/p/proximitymarketing/\">{% trans "There's a new version available" %}</a><h1/>")
        document.write("<p>{% trans "New Version" %}: ")
        document.write(reply.latest)
        document.write("</p><p>{% trans "Your Version" %}: {{ version.current }}</p>")
    }
</script>
					    
<h1>{% trans "Server Statistics" %}</h1>
<table id="stats">
    <tr>
	<td>{% trans "Seen" %}</td>
	<td>{{ stats.seen.total }}</td>
    </tr>
    <tr>
	<td>{% trans "Per Dongle" %}</td>
	<td>
	    <table id="stats_per_dongle">
		{% for d in stats.seen.perdongle %}
		    <tr>
			<td>{{ d.address}}</td>
			<td>{{ d.count }}</td>
		    </tr>
		{% endfor %}
	    </table>
	</td>		
    <tr>
	<td>{% trans "Valid Obex" %}</td>
	<td>{{ stats.valid }}</td>
    </tr>
    <tr>
	<td>{% trans "Tried" %}</td>
	<td>{{ stats.tries }}</td>
    </tr>
    <tr>
	<td>{% trans "Timeout" %}</td>
	<td>{{ stats.timeout }}</td>
    </tr>
    <tr>
	<td>{% trans "Rejected" %}</td>
	<td>{{ stats.rejected }}</td>
    </tr>
    <tr>
	<td>{% trans "Accepted" %}</td>
	<td>{{ stats.accepted }}</td>
    <tr>
    <tr>
	<td><a href="stats/restart" class="btn">{% trans "Reset Statistics" %}</a></td>
    </tr>
    
    {% if stats.error %}
    <tr id="error">
	<td>{% trans "Error Message" %}</td>
	<td>{{ stats.error }}</td>
    </tr>
    {% endif %}
</table>


<h1>{% trans "Server Status" %}</h1>
<table id="rpc">
    <tr>
	<td>{% trans "RPC Server is running" %}</td>
	<td>{{ rpc.running|yesno:_("yes,no") }}</td>
    </tr>
    <tr>
        <td>{% trans "Uploaders Connected" %}</td>
	<td>{{ rpc.uploaders }}</td>
    </tr>
    <tr>
	<td>{% trans "Scanners Connected" %}</td>
	<td>{{ rpc.scanners }}</td>
    </tr>
    {% if rpc.error %}
	<tr id="error">
	    <td>{% trans "Error Message" %}</td>
	    <td>{{ rpc.error }}</td>
	</tr>
    {% endif %}
    <tr>
	<td><a href="../rpc/restart" class="btn">{% trans "Restart RPC Server" %}</a></td>
	<td></td>
	<td></td>
    </tr>
</table>

<h1>{% trans "Known Dongles" %}</h1>
<table id="knwon">
    <tr>
	<td>{% trans "Address" %}</td>
	<td>{% trans "Is Scanner" %}</td>
	<td>{% trans "Scanner Enabled" %}</td>
	<td>{% trans "Scanner Priority" %}</td>
	<td>{% trans "Is Uploader" %}</td>
	<td>{% trans "Uploader Enabled" %}</td>	
	<td>{% trans "Max Connections" %}</td>
	<td>{% trans "Position X" %}</td>
	<td>{% trans "Position Y" %}</td>
    </tr>
    {% for dongle in rpc.dongles %}
    <tr>
	<td>{{ dongle.address }}</td>
	<td>{{ dongle.isScanner }}</td>
	<td>{{ dongle.scan_enabled }}</td>	
	<td>{{ dongle.scan_pri }}</td>
	<td>{{ dongle.isUploader }}</td>
	<td>{{ dongle.upload_enabled }}</td>
	<td>{{ dongle.max_conn }}</td>
	<td>{{ dongle.position_x }}</td>
	<td>{{ dongle.position_y }}</td>
	<td><a href="configure/dongle/{{ dongle.address }}" class="btn">{% trans "Configure" %}</a></td>
    </tr>
    {% endfor %}
</table>

<h1>{% trans "Marketing Campaigns" %}</h1>
{% for camp in camps %}
    <h2><a href="admin/openproximity/marketingcampaign/{{camp.pk}}/" class="btn">{{ camp.friendly_name }}</a></h2>
    <table id="camp">
    <tr>
	<td>{% trans "Enabled" %}</td>
	<td>{{ camp.enabled|yesno:_("yes,no") }}
    </tr>
    <tr>
	<td>{% trans "Service" %}</td>
	<td>{{ camp.rules.get_service_display }}</td>
    </tr>
    <tr>
	<td>{% trans "Start" %}</td>
	<td>{{ camp.rules.start }}</td>
    </tr>
    <tr>
	<td>{% trans "End" %}</td>
	<td>{{ camp.rules.end }}</td>
    </tr>
    <tr>
	<td>{% trans "Name Filter" %}</td>
	<td>{{ camp.rules.name_filter }}</td>
    </tr>
    <tr>
	<td>{% trans "Address Filter" %}</td>
	<td>{{ camp.rules.addr_filter }}</td>
    </tr>
    <tr>
	<td>{% trans "DevClass Filter" %}</td>
	<td>{{ camp.rules.devclass_filter }}</td>
    </tr>
    {% for file in camp.rules.files.all %}
    <tr>
	<td>{% trans "Serving File" %}</td>
	<td>{{ file.file.name }}</td>
	<td>{% trans "Chances" %}</td>
	<td>{{ file.chance }}</td>
	<td><a href="file/grab/{{file.file.name}}" class="btn">{% trans "See File" %}</a></td>
    </tr>
    {% endfor %}
    </table>
    

{% endfor %} <!-- camps -->

{% endblock %}
{% block footer %}
<script type="text/javascript">
    var reply=compare_version({{version.current}});
    document.write("<p>server version: <b>")
    document.write(reply.latest)
    document.write("</b> running version: <b>{{ version.current }}</b></p>")
</script>
{% endblock %}
